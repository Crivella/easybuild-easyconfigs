easyblock = 'PythonBundle'

name = 'SciPy-bundle'
version = '2025.06'

homepage = 'https://python.org/'
description = "Bundle of Python packages for scientific software"

toolchain = {'name': 'gfbf', 'version': '2025a'}
toolchainopts = {'pic': True, 'lowopt': True}

builddependencies = [
    ('hypothesis', '6.133.2'),
    ('UnZip', '6.0'),
    # scipy >= 1.9.0 uses Meson/Ninja
    ('Meson', '1.6.1'),
    ('meson-python', '0.18.0'),
    ('Ninja', '1.12.1'),
    ('pkgconf', '2.3.0'),  # required by scipy
    ('Cython', '3.1.1'),  # required by numpy and scipy
    ('pybind11', '2.13.6'),  # required by scipy
]

dependencies = [
    ('Python', '3.13.1'),
    ('Python-bundle-PyPI', '2025.04'),
]

# order is important!
exts_list = [
    ('numpy', '2.2.6', {
        'patches': [
            'numpy-1.22.3_disable-broken-override-test.patch',
            'numpy-1.26.4_fix-riscv64-test-failures.patch',
        ],
        'checksums': [
            {'numpy-2.2.6.tar.gz': 'e29554e2bef54a90aa5cc07da6ce955accb83f21ab5de01a62c8478897b264fd'},
            {'numpy-1.22.3_disable-broken-override-test.patch':
             '9c589bb073b28b25ff45eb3c63c57966aa508dd8b318d0b885b6295271e4983c'},
            {'numpy-1.26.4_fix-riscv64-test-failures.patch':
             '81bd487dbca6da8285971a16a2c7b488718a051d3cd66450277bed6ff21741de'},
        ],
    }),
    ('ply', '3.11', {
        'checksums': ['00c7c1aaa88358b9c765b6d3000c6eec0ba42abca5351b095321aef446081da3'],
    }),
    ('gast', '0.6.0', {
        'checksums': ['88fc5300d32c7ac6ca7b515310862f71e6fdf2c029bbec7c66c0f5dd47b6b1fb'],
    }),
    ('beniget', '0.4.2.post1', {
        'checksums': ['a0258537e65e7e14ec33a86802f865a667f949bb6c73646d55e42f7c45a052ae'],
    }),
    ('pythran', '0.18.0', {
        'checksums': ['5c003e8cbedf6dbb68c2869c49fc110ce8b5e8982993078a4a819f1dadc4fc6a'],
    }),
    ('versioneer', '0.29', {
        'checksums': ['5ab283b9857211d61b53318b7c792cf68e798e765ee17c27ade9f6c924235731'],
    }),
    ('scipy', '1.15.3', {
        'enable_slow_tests': True,
        'ignore_test_result': False,
        'patches': [
            'scipy-1.11.1_disable-tests.patch',
            'scipy-1.11.1_xfail-aarch64_test_maxiter_worsening.patch',
            'scipy-1.13.1_TestLinprogIPSparse.patch',
        ],
        'checksums': [
            {'scipy-1.15.3.tar.gz': 'eae3cf522bc7df64b42cad3925c876e1b0b6c35c1337c93e12c0f366f55b0eaf'},
            {'scipy-1.11.1_disable-tests.patch': '906bfb03397d94882ccdc1b93bc2c8e854e0e060c2d107c83042992394e6a4af'},
            {'scipy-1.11.1_xfail-aarch64_test_maxiter_worsening.patch':
             '918c8e6fa8215d459126f267764c961bde729ea4a116c7f6287cddfdc58ffcea'},
            {'scipy-1.13.1_TestLinprogIPSparse.patch':
             '7213c2690b76c69f7e7103529cea3fa2098c05fbea556f04325fab9ca8c065f5'},
        ],
    }),
    ('numexpr', '2.10.2', {
        'checksums': ['b0aff6b48ebc99d2f54f27b5f73a58cb92fde650aeff1b397c71c8788b4fff1a'],
    }),
    ('bottleneck', '1.5.0', {
        'checksums': ['c860242cf20e69d5aab2ec3c5d6c8c2a15f19e4b25b28b8fca2c2a12cefae9d8'],
    }),
    ('tzdata', '2025.2', {
        'checksums': ['b60a638fcc0daffadf82fe0f57e53d06bdec2f36c4df66280ae79bce6bd6f2b9'],
    }),
    ('pandas', '2.2.3', {
        'preinstallopts': "export PANDAS_CI=0 && ",
        'checksums': ['4f18ba62b61d7e192368b84517265a99b4d7ee8912f8708660fb4a366cc82667'],
    }),
    ('mpmath', '1.3.0', {
        'checksums': ['7a28eb2a9774d00c7bc92411c19a89209d5da7c4c9a9e227be8330a23a25b91f'],
    }),
    ('deap', '1.4.3', {
        'modulename': 'deap.base',
        'checksums': ['7c97088fb05835bdc255bec475cb0e778de2b43e44cbefbf2bcd655aeec865fd'],
    }),
]

moduleclass = 'lang'
