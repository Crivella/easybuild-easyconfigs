easyblock = 'Binary'

name = 'AiiDA'
version = '2.5.1'

homepage = 'https://www.aiida.net/'
description = """Scripts for bootstrapping and cleaning up an AiiDA installation."""

toolchain = {'name': 'gfbf', 'version': '2023a'}

sources = [
    'aiida_bootstrap.sh',
    'aiida_cleanup.sh',
]
checksums = [
    {'aiida_bootstrap.sh': 'c92bc1c0ff23b2d54be2a5367df88abc94a413555b34fab830c5dcea84507650'},
    {'aiida_cleanup.sh': '5f6a46c1f9b4381fe012c94323c38e72d8a314e5f7b81a4f3517ebe6034f3cfd'},
]

builddependencies = [
    ('binutils', '2.40'),
]
dependencies = [
    ('aiida-core', '2.5.1'),
    ('RabbitMQ', '3.13.1'),
    ('PostgreSQL', '16.1'),
]

extract_sources = True

install_cmd = "chmod +x *.sh && mkdir -p %(installdir)s/bin && cp *.sh %(installdir)s/bin"

sanity_check_paths = {
    'files': ['bin/aiida_bootstrap.sh', 'bin/aiida_cleanup.sh'],
    'dirs': [],
}

moduleclass = 'tools'

modluafooter = """
local home = os.getenv("HOME")
local eb_config_dir = pathJoin(home, ".eb_aiida")

setenv("EB_CONFIG_DIR", eb_config_dir)
setenv("PGHOST", eb_config_dir)
setenv("RMQ_BASEDIR", pathJoin(eb_config_dir, "rabbitmq"))
setenv("RABBITMQ_NODENAME", "rabbit-" .. os.getenv("USER"))
setenv("AIIDA_PATH", eb_config_dir)
"""
