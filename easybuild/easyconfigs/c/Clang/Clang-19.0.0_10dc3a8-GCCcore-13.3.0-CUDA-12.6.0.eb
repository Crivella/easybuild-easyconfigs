##
# This file is an EasyBuild reciPY as per https://github.com/easybuilders/easybuild
#
# Copyright:: Copyright 2013-2015 Dmitri Gribenko, Ward Poelmans
# Authors:: Dmitri Gribenko <gribozavr@gmail.com>
# Authors:: Ward Poelmans <wpoely86@gmail.com>
# License:: GPLv2 or later, MIT, three-clause BSD.
# $Id$
##

# thembl: according to cmake/llvm-hash.txt Triton 3.1.0 (5fe38ffd73c2ac6ed6323b554205186696631c6f) requires 
# this commit 10dc3a8e916d73291269e5e2b82dd22681489aa1 of LLVM

name = 'Clang'
# local_date = '20240523'
local_commit = '10dc3a8e916d73291269e5e2b82dd22681489aa1'
version = '19.0.0_%s' % local_commit[:7] # acc. to ./llvm/utils/gn/secondary/llvm/version.gni
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://clang.llvm.org/'
description = """C, C++, Objective-C compiler, based on LLVM.  Does not
 include C++ standard library -- use libstdc++ from GCC."""

# Clang also depends on libstdc++ during runtime, but this dependency is
# already specified as the toolchain.
toolchain = {'name': 'GCCcore', 'version': '13.3.0'}

source_urls = ['https://github.com/llvm/llvm-project/archive/']
sources = [{
    'download_filename': '%s.tar.gz' % local_commit,
    'filename': 'llvm-project-%s.tar.gz' % version,
}]
checksums = ['6ee5e0f9a49d41b5f48ebc4613ce3371f686bf70fcece9f849aba3c37bdeb3e8']

builddependencies = [
    ('CMake', '3.29.3'),
    ('Perl', '5.38.2'),
    # Including Python bindings would require this as a runtime dep
    # and SWIG as an additional build dep
    ('Python', '3.12.3'),
]
dependencies = [
    # since Clang is a compiler, binutils is a runtime dependency too
    ('binutils', '2.42'),
    ('hwloc', '2.10.0'),
    ('libxml2', '2.12.7'),
    ('ncurses', '6.5'),
    ('GMP', '6.3.0'),
    ('Z3', '4.13.0'),
    ('CUDA', '12.6.0', '', SYSTEM),

]
configopts = '-DUSE_DEPRECATED_GCC_INSTALL_PREFIX=1 '
# clang easyblock requires an update:
#  GCC_INSTALL_PREFIX is deprecated and will be removed.  Use configuration
#  files (https://clang.llvm.org/docs/UsersManual.html#configuration-files)to
#  specify the default --gcc-install-dir= or --gcc-triple=.  --gcc-toolchain=
#  is discouraged.  See https://github.com/llvm/llvm-project/pull/77537 for
#  detail.

# If True, Flang does not currently support building with LLVM exceptions enabled.
enable_rtti = False

assertions = True
python_bindings = False
skip_all_tests = True

llvm_runtimes = ['libunwind', 'libcxx', 'libcxxabi']
llvm_projects = ['polly', 'lld', 'lldb', 'clang-tools-extra', 'flang']

moduleclass = 'compiler'
