easyblock = 'CMakeMake'

name = 'REViewer'
version = '0.2.7'
toolchain = {'name': 'foss', 'version': '2024a'}
toolchainopts = {'pic': True, 'cstd': 'c++14'}


homepage = 'https://github.com/Illumina/REViewer'
description = """REViewer is a tool for visualizing alignments of reads in regions containing tandem repeats. REViewer
 requires a BAMlet with graph-realigned reads generated by ExpansionHunter and the corresponding variant catalog."""
source_urls = ['https://github.com/Illumina/REViewer/archive/refs/tags']
sources = ['v%(version)s.tar.gz']
patches = [
    'GraphCoordinates.cpp.patch',
    ('graph-tools.CMakeLists.txt.patch', 'reviewer/thirdparty/graph-tools'),
    ('reviewer.CMakeLists.txt.patch', 'reviewer')
]
checksums = [
    {'v0.2.7.tar.gz': '8411c40028907b0294b1899cd20af6934325796da160511b649044ecf9a5169f'},
    {'GraphCoordinates.cpp.patch': '39b37b42fbabc5dd6206f62fc9c9e3ead329b3f33fb27a72ecffca681b2fe9fc'},
    {'graph-tools.CMakeLists.txt.patch': '7df2adc1e3bf1b1efa303d1b13a44c713914f399aa206c45ae1405d0fa48d70f'},
    {'reviewer.CMakeLists.txt.patch': 'ebe8995aae716557aa947e0cc52f2784075fccd0ce69d5c7bea326de06c836b4'},
]

configopts = "-DCMAKE_EXE_LINKER_FLAGS='-L$EBROOTOPENSSL -lssl -lcrypto'"

start_dir = 'reviewer'

builddependencies = [
    ('CMake', '3.29.3'),
]

# Dependencies based on reviewer/CMakeLists.txt
dependencies = [
    ('Boost', '1.85.0'),
    ('HTSlib', '1.21'),
    ('zlib', '1.3.1'),
    ('bzip2', '1.0.8'),
    ('XZ', '5.4.5'),  # Provides liblzma
    ('spdlog', '1.12.0'),
    ('Catch2', '2.13.10'),
    ('cURL', '8.7.1'),
    ('OpenSSL', '3', '', SYSTEM),
]

sanity_check_paths = {
    'files': ['bin/REViewer'],
    'dirs': [],
}

sanity_check_commands = ["REViewer --version", "REViewer --help"]
